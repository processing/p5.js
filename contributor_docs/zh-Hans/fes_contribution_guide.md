<!-- å‹å¥½é”™è¯¯ç³»ç»Ÿä»£ç åº“æ¦‚è¿°å’Œå¼€å‘è€…å‚è€ƒã€‚ -->

# å‹å¥½é”™è¯¯ç³»ç»Ÿè´¡çŒ®æŒ‡å—

`core/friendly_errors`æ–‡ä»¶å¤¹åŒ…å«äº†p5jsçš„å‹å¥½é”™è¯¯ç³»ç»Ÿ(FES)ä»£ç ï¼Œè¯¥ç³»ç»Ÿè´Ÿè´£ç”Ÿæˆå‹å¥½é”™è¯¯æ¶ˆæ¯æˆ–å‹å¥½é”™è¯¯ã€‚æ‚¨å¯èƒ½å·²ç»åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°ä»¥"`ğŸŒ¸ p5.js says:`"å¼€å¤´çš„å‹å¥½é”™è¯¯æ¶ˆæ¯ï¼Œè¿™äº›æ¶ˆæ¯æ˜¯å¯¹é»˜è®¤æµè§ˆå™¨ç”Ÿæˆçš„é”™è¯¯æ¶ˆæ¯çš„è¡¥å……ã€‚

FESåŒ…å«å¤šä¸ªè´Ÿè´£ç”Ÿæˆä¸åŒç±»å‹é”™è¯¯çš„å‹å¥½é”™è¯¯æ¶ˆæ¯çš„å‡½æ•°ã€‚è¿™äº›å‡½æ•°ä»å„ç§ä½ç½®æ”¶é›†é”™è¯¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶åŠ è½½é”™è¯¯å’Œè‡ªåŠ¨æ’­æ”¾é”™è¯¯çš„é”™è¯¯å¤„ç†ï¼Œåº“å†…çš„å‚æ•°æ£€æŸ¥ï¼Œä»¥åŠp5.jsè´¡çŒ®è€…å®ç°çš„å…¶ä»–è‡ªå®šä¹‰é”™è¯¯å¤„ç†ã€‚

æœ¬æ–‡æ¡£é¦–å…ˆæ¦‚è¿°äº†FESçš„ä¸»è¦å‡½æ•°åŠå…¶ä½ç½®ã€‚åœ¨éšåçš„å‚è€ƒéƒ¨åˆ†ï¼Œæ‚¨å°†æ‰¾åˆ°æœ‰å…³è¿™äº›å•ç‹¬å‡½æ•°çš„å®Œæ•´ä¿¡æ¯ï¼ˆæè¿°ã€è¯­æ³•ã€å‚æ•°ã€ä½ç½®ï¼‰ã€‚åœ¨æ–‡æ¡£çš„æœ€åéƒ¨åˆ†ï¼Œæ‚¨å°†æ‰¾åˆ°æˆ‘ä»¬ä»¥å‰çš„è´¡çŒ®è€…çš„ç¬”è®°ï¼ˆå¼€å‘ç¬”è®°ï¼‰ï¼Œæ¦‚è¿°äº†FESçš„å·²çŸ¥é™åˆ¶å’Œå¯èƒ½çš„æœªæ¥æ–¹å‘ã€‚å¦‚æœæ‚¨æ­£åœ¨è€ƒè™‘ä¸ºFESåšè´¡çŒ®ï¼Œè¯·æŸ¥çœ‹[å¼€å‘ç¬”è®°](#-å¼€å‘ç¬”è®°)ï¼


## æ¦‚è¿°

ç”Ÿæˆå‹å¥½é”™è¯¯æ¶ˆæ¯çš„ä¸»è¦å‡½æ•°æ˜¯ï¼š

- `p5._friendlyError()`ï¼šå°†è¾“å…¥æ¶ˆæ¯æ ¼å¼åŒ–å¹¶æ‰“å°ï¼ˆé€šè¿‡`_report()`ï¼‰ä¸ºå‹å¥½é”™è¯¯
- `p5._validateParameters()`ï¼šéªŒè¯æ¥æ”¶åˆ°çš„è¾“å…¥å€¼æ˜¯å¦æœ‰é”™è¯¯ç±»å‹æˆ–ç¼ºå°‘å€¼
- `p5._friendlyFileLoadError()`ï¼šæŒ‡å¯¼ç”¨æˆ·è§£å†³ä¸æ–‡ä»¶åŠ è½½å‡½æ•°ç›¸å…³çš„é”™è¯¯
- `p5._friendlyAutoplayError()`ï¼šæŒ‡å¯¼ç”¨æˆ·è§£å†³ä¸æµè§ˆå™¨è‡ªåŠ¨æ’­æ”¾ç­–ç•¥ç›¸å…³çš„é”™è¯¯

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå›¾è¡¨ï¼Œæ¦‚è¿°äº†FESä¸­æ‰€æœ‰å‡½æ•°çš„ä½ç½®ä»¥åŠå®ƒä»¬å¦‚ä½•ç›¸äº’è¿æ¥ï¼š

![FESä¸­ä½¿ç”¨çš„æ–‡ä»¶åŠå…¶ç”¨é€”çš„å›¾è¡¨](../images/fes.svg)

å„ä¸ªæ–‡ä»¶åŒ…å«ä»¥ä¸‹ä¸»è¦FESå‡½æ•°ï¼š

- `fes_core.js`ï¼šåŒ…å«`_report()`ã€`_friendlyError()`å’Œ`_friendlyAutoplayError()`ï¼Œä»¥åŠç”¨äºæ ¼å¼åŒ–å’Œæµ‹è¯•å‹å¥½é”™è¯¯çš„å…¶ä»–è¾…åŠ©å‡½æ•°ã€‚
- `validate_params.js`ï¼šåŒ…å«`_validateParameters()`ä»¥åŠç”¨äºå‚æ•°éªŒè¯çš„å…¶ä»–è¾…åŠ©å‡½æ•°ã€‚
- `file_errors.js`ï¼šåŒ…å«`_friendlyFileLoadError()`å’Œç”¨äºæ–‡ä»¶åŠ è½½é”™è¯¯çš„å…¶ä»–è¾…åŠ©å‡½æ•°ã€‚
- `browser_errors.js`ï¼šåŒ…å«å°†ä½¿ç”¨FESå…¨å±€é”™è¯¯ç±»ï¼ˆ`fes.globalErrors`ï¼‰ç”Ÿæˆçš„æµè§ˆå™¨é”™è¯¯åˆ—è¡¨ã€‚
- `stacktrace.js`ï¼šåŒ…å«è§£æé”™è¯¯å †æ ˆçš„ä»£ç ï¼ˆå€Ÿç”¨è‡ª[stacktrace.js](https://github.com/stacktracejs/stacktrace.js)ï¼‰ã€‚


## ğŸ“š å‚è€ƒï¼šFESå‡½æ•°

### `_report()`

#### æè¿°

`_report()`æ˜¯ç›´æ¥å°†é”™è¯¯è¾…åŠ©æ¶ˆæ¯è¾“å‡ºåˆ°æ§åˆ¶å°çš„ä¸»è¦å‡½æ•°ã€‚

**æ³¨æ„ï¼š**å¦‚æœè®¾ç½®äº†`p5._fesLogger`ï¼ˆå³ï¼Œæˆ‘ä»¬æ­£åœ¨è¿è¡Œæµ‹è¯•ï¼‰ï¼Œåˆ™å°†ä½¿ç”¨å®ƒä»£æ›¿`console.log`ã€‚è¿™åœ¨æˆ‘ä»¬é€šè¿‡Mochaè¿è¡Œæµ‹è¯•æ—¶éå¸¸æœ‰ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`_fesLogger`å°†è®©`_report`å°†é”™è¯¯æ¶ˆæ¯ä½œä¸ºå­—ç¬¦ä¸²ä¼ é€’ç»™Mochaï¼Œè¯¥å­—ç¬¦ä¸²å°†ä¸æ–­è¨€çš„å­—ç¬¦ä¸²è¿›è¡Œæµ‹è¯•ã€‚


#### è¯­æ³•

```js
_report(message);

_report(message, func);

_report(message, func, color);
```


#### å‚æ•°

```
@param  {String}        message   è¦æ‰“å°çš„æ¶ˆæ¯
@param  {String}        [func]    å‡½æ•°åç§°
@param  {Number|String} [color]   CSSé¢œè‰²ä»£ç 
```

`[func]`è¾“å…¥ç”¨äºåœ¨é”™è¯¯æ¶ˆæ¯æœ«å°¾é™„åŠ å‚è€ƒé“¾æ¥ã€‚

`[color]`è¾“å…¥ç”¨äºè®¾ç½®é”™è¯¯æ¶ˆæ¯çš„é¢œè‰²å±æ€§ã€‚è¿™åœ¨å½“å‰ç‰ˆæœ¬çš„å‹å¥½é”™è¯¯æ¶ˆæ¯ä¸­æœªä½¿ç”¨ã€‚


#### ä½ç½®

core/friendly\_errors/fes\_core.js

### `_friendlyError()`

#### æè¿°

`_friendlyError()`åˆ›å»ºå¹¶æ‰“å°å‹å¥½é”™è¯¯æ¶ˆæ¯ã€‚ä»»ä½•p5å‡½æ•°éƒ½å¯ä»¥è°ƒç”¨æ­¤å‡½æ•°æ¥æä¾›å‹å¥½é”™è¯¯æ¶ˆæ¯ã€‚

`_friendlyFileLoadError()`ä½äºä»¥ä¸‹å‡½æ•°å†…ï¼š

- `image/loading_displaying/loadImage()`
- `io/files/loadFont()`
- `io/files/loadTable()`
- `io/files/loadJSON()`
- `io/files/loadStrings()`
- `io/files/loadXML()`
- `io/files/loadBytes()`ã€‚

å¯¹`_friendlyFileLoadError`çš„è°ƒç”¨åºåˆ—çœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```
_friendlyFileLoadError
  _report
```


#### è¯­æ³•

```js
_friendlyFileLoadError(errorType, filePath);
```


#### å‚æ•°

```
@param  {Number}  errorType   æ–‡ä»¶åŠ è½½é”™è¯¯ç±»å‹çš„ç¼–å·
@param  {String}  filePath    å¯¼è‡´é”™è¯¯çš„æ–‡ä»¶è·¯å¾„
```

`errorType`è¾“å…¥æŒ‡çš„æ˜¯`core/friendly_errors/file_errors.js`ä¸­æšä¸¾çš„ç‰¹å®šç±»å‹çš„æ–‡ä»¶åŠ è½½é”™è¯¯ã€‚p5.jsä¸­çš„æ–‡ä»¶åŠ è½½é”™è¯¯è¢«åˆ†ä¸ºå„ç§ä¸åŒçš„æƒ…å†µã€‚è¿™ç§åˆ†ç±»æ—¨åœ¨ä¾¿äºæä¾›ä¸ä¸åŒé”™è¯¯åœºæ™¯ç›¸å¯¹åº”çš„ç²¾ç¡®å’Œä¿¡æ¯ä¸°å¯Œçš„é”™è¯¯æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼Œå½“å®ƒæ— æ³•è¯»å–å­—ä½“æ–‡ä»¶ä¸­çš„æ•°æ®æ—¶ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºä¸å°è¯•åŠ è½½è¿‡å¤§æ— æ³•è¯»å–çš„æ–‡ä»¶æ—¶ä¸åŒçš„é”™è¯¯ã€‚


#### ç¤ºä¾‹

æ–‡ä»¶åŠ è½½é”™è¯¯ç¤ºä¾‹ï¼š

```js
/// ç¼ºå°‘å­—ä½“æ–‡ä»¶
let myFont;
function preload() {
  myFont = loadFont('assets/OpenSans-Regular.ttf');
}
function setup() {
  fill('#ED225D');
  textFont(myFont);
  textSize(36);
  text('p5*js', 10, 50);
}
function draw() {}
```

é™¤äº†æµè§ˆå™¨çš„"ä¸æ”¯æŒ"é”™è¯¯å¤–ï¼ŒFESè¿˜å°†åœ¨æ§åˆ¶å°ä¸­ç”Ÿæˆä»¥ä¸‹æ¶ˆæ¯ï¼š

```
ğŸŒ¸ p5.js says: çœ‹èµ·æ¥åŠ è½½å­—ä½“æ—¶å‡ºç°äº†é—®é¢˜ã€‚è¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„(assets/OpenSans-Regular.ttf)æ˜¯å¦æ­£ç¡®ï¼Œå°è¯•åœ¨çº¿æ‰˜ç®¡æ–‡ä»¶ï¼Œæˆ–è¿è¡Œæœ¬åœ°æœåŠ¡å™¨ã€‚

+ æ›´å¤šä¿¡æ¯ï¼šhttps://github.com/processing/p5.js/wiki/Local-server
```


#### ä½ç½®

/friendly\_errors/file\_errors.js


### `_friendlyAutoplayError()`

#### æè¿°

å¦‚æœå­˜åœ¨ä¸æ’­æ”¾åª’ä½“ï¼ˆä¾‹å¦‚è§†é¢‘ï¼‰ç›¸å…³çš„é”™è¯¯ï¼Œ`_friendlyAutoplayError()`ä¼šåœ¨å†…éƒ¨è°ƒç”¨ï¼Œè¿™å¾ˆå¯èƒ½æ˜¯ç”±äºæµè§ˆå™¨çš„è‡ªåŠ¨æ’­æ”¾ç­–ç•¥ã€‚

å®ƒè°ƒç”¨`translator()`ä½¿ç”¨é”®`fes.autoplay`ç”Ÿæˆå¹¶æ‰“å°å‹å¥½é”™è¯¯æ¶ˆæ¯ã€‚æ‚¨å¯ä»¥åœ¨`translations/en/translation.json`ä¸­æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„é”®ã€‚


#### ä½ç½®

core/friendly\_errors/fes\_core.js


### `_validateParameters()`

#### æè¿°

`_validateParameters()`é€šè¿‡å°†è¾“å…¥å‚æ•°ä¸`docs/reference/data.json`ä¸­çš„ä¿¡æ¯åŒ¹é…æ¥è¿è¡Œå‚æ•°éªŒè¯ï¼Œè¯¥ä¿¡æ¯æ˜¯ä»å‡½æ•°çš„å†…è”æ–‡æ¡£åˆ›å»ºçš„ã€‚å®ƒæ£€æŸ¥å‡½æ•°è°ƒç”¨æ˜¯å¦åŒ…å«æ­£ç¡®æ•°é‡å’Œæ­£ç¡®ç±»å‹çš„å‚æ•°ã€‚

å®ƒè°ƒç”¨`translator()`ä½¿ç”¨é”®`fes.friendlyParamError.*`ç”Ÿæˆå¹¶æ‰“å°å‹å¥½é”™è¯¯æ¶ˆæ¯ã€‚æ‚¨å¯ä»¥åœ¨`translations/en/translation.json`ä¸­æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„é”®ã€‚

å¯ä»¥é€šè¿‡`p5._validateParameters(FUNCT_NAME, ARGUMENTS)`æˆ–`p5.prototype._validateParameters(FUNCT_NAME, ARGUMENTS)`åœ¨éœ€è¦å‚æ•°éªŒè¯çš„å‡½æ•°å†…éƒ¨è°ƒç”¨æ­¤å‡½æ•°ã€‚å»ºè®®å°†é™æ€ç‰ˆæœ¬`p5._validateParameters`ç”¨äºä¸€èˆ¬ç”¨é€”ã€‚`p5.prototype._validateParameters(FUNCT_NAME, ARGUMENTS)`ä¸»è¦ç”¨äºè°ƒè¯•å’Œå•å…ƒæµ‹è¯•ã€‚

`_validateParameters()`å‡½æ•°ä½äºè¿™äº›å‡½æ•°å†…ï¼š

- `accessibility/outputs`
- `color/creating_reading`
- `color/setting`
- `core/environment`
- `core/rendering`
- `core/shape/2d_primitives`
- `core/shape/attributes`
- `core/shape/curves`
- `core/shape/vertex`
- `core/transform`
- `data/p5.TypedDict`
- `dom/dom`
- `events/acceleration`
- `events/keyboard`
- `image/image`
- `image/loading_displaying`
- `image/p5.Image`
- `image/pixel`
- `io/files`
- `math/calculation`
- `math/random`
- `typography/attributes`
- `typography/loading_displaying`
- `utilities/string_functions`
- `webgl/3d_primitives`
- `webgl/interaction`
- `webgl/light`
- `webgl/loading`
- `webgl/material`
- `webgl/p5.Camera`

ä»`_validateParameters`çš„è°ƒç”¨åºåˆ—çœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```
validateParameters
   buildArgTypeCache
      addType
    lookupParamDoc
    scoreOverload
      testParamTypes
      testParamType
    getOverloadErrors
    _friendlyParamError
      ValidationError
      report
        friendlyWelcome
```


#### è¯­æ³•

```js
_validateParameters(func, args);
```


#### å‚æ•°

```
@param  {String}  func    è¢«è°ƒç”¨çš„å‡½æ•°çš„åç§°
@param  {Array}   args    ç”¨æˆ·è¾“å…¥å‚æ•°
```


#### ç¤ºä¾‹

ç¼ºå°‘å‚æ•°çš„ç¤ºä¾‹ï¼š

```js
arc(1, 1, 10.5, 10);
```

FESå°†åœ¨æ§åˆ¶å°ä¸­ç”Ÿæˆä»¥ä¸‹æ¶ˆæ¯ï¼š

```
ğŸŒ¸ p5.js says: [sketch.js, line 13] arc()è‡³å°‘éœ€è¦6ä¸ªå‚æ•°ï¼Œä½†åªæ”¶åˆ°äº†4ä¸ªã€‚ (https://p5js.org/reference/p5/arc)
```

ç±»å‹ä¸åŒ¹é…çš„ç¤ºä¾‹ï¼š

```js
arc(1, ',1', 10.5, 10, 0, Math.PI);
```

FESå°†åœ¨æ§åˆ¶å°ä¸­ç”Ÿæˆä»¥ä¸‹æ¶ˆæ¯ï¼š

```
ğŸŒ¸ p5.js says: [sketch.js, line 14] arc()çš„ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦Numberç±»å‹ï¼Œä½†æ”¶åˆ°äº†stringç±»å‹ã€‚ (https://p5js.org/reference/p5/arc)
```


#### ä½ç½®

core/friendly\_errors/validate\_params.js


### `fesErrorMonitor()`

#### æè¿°

`fesErrorMonitor()`ç›‘æ§æµè§ˆå™¨é”™è¯¯æ¶ˆæ¯ï¼ŒçŒœæµ‹é”™è¯¯çš„æ¥æºå¹¶ä¸ºç”¨æˆ·æä¾›é¢å¤–çš„æŒ‡å¯¼ã€‚è¿™åŒ…æ‹¬å †æ ˆè·Ÿè¸ªï¼Œå®ƒæ˜¯ç¨‹åºä¸­ç›´åˆ°æŠ›å‡ºé”™è¯¯ç‚¹ä¸ºæ­¢è°ƒç”¨çš„å‡½æ•°çš„é¡ºåºåˆ—è¡¨ã€‚å †æ ˆè·Ÿè¸ªå¯¹äºç¡®å®šé”™è¯¯æ˜¯å†…éƒ¨çš„è¿˜æ˜¯ç”±ç”¨æˆ·ç›´æ¥è°ƒç”¨çš„æŸäº›å†…å®¹å¼•èµ·çš„éå¸¸æœ‰ç”¨ã€‚

å®ƒè°ƒç”¨`translator()`ä½¿ç”¨é”®`fes.globalErrors.*`ç”Ÿæˆå¹¶æ‰“å°å‹å¥½é”™è¯¯æ¶ˆæ¯ã€‚æ‚¨å¯ä»¥åœ¨`translations/en/translation.json`ä¸­æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„é”®ã€‚

ä»¥ä¸‹æ˜¯é€šè¿‡`fesErrorMonitor()`ç”Ÿæˆçš„é”™è¯¯æ¶ˆæ¯çš„ç»¼åˆåˆ—è¡¨ï¼š

- ä½¿ç”¨é”®çš„å‹å¥½é”™è¯¯æ¶ˆæ¯ï¼š`fes.globalErrors.syntax.*`ã€`fes.globalErrors.reference.*`ã€`fes.globalErrors.type.*`ã€‚
- é€šè¿‡`processStack()`ä½¿ç”¨é”®çš„"å†…éƒ¨åº“"é”™è¯¯æ¶ˆæ¯ï¼š`fes.wrongPreload`ã€`fes.libraryError`ã€‚
- é€šè¿‡`printFriendlyStack()`ä½¿ç”¨é”®çš„å †æ ˆè·Ÿè¸ªæ¶ˆæ¯ï¼š`fes.globalErrors.stackTop`ã€`fes.globalErrors.stackSubseq`ã€‚
- é€šè¿‡`handleMisspelling()`ä½¿ç”¨é”®çš„æ‹¼å†™æ£€æŸ¥æ¶ˆæ¯ï¼ˆæ¥è‡ªå¼•ç”¨é”™è¯¯ï¼‰ï¼š`fes.misspelling`ã€‚

`_fesErrorMonitor()`ç”±`window`ä¸Šçš„`error`äº‹ä»¶å’Œæœªå¤„ç†çš„æ‰¿è¯ºæ‹’ç»ï¼ˆ`unhandledrejection`äº‹ä»¶ï¼‰è‡ªåŠ¨è§¦å‘ã€‚ä½†æ˜¯ï¼Œå¯ä»¥åœ¨catchå—ä¸­æ‰‹åŠ¨è°ƒç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```js
try { someCode(); } catch(err) { p5._fesErrorMonitor(err); }
```

è¯¥å‡½æ•°ç›®å‰é€‚ç”¨äº`ReferenceError`ã€`SyntaxError`å’Œ`TypeError`çš„å­é›†ã€‚æ‚¨å¯ä»¥åœ¨`browser_errors.js`ä¸­æ‰¾åˆ°æ”¯æŒçš„é”™è¯¯çš„å®Œæ•´åˆ—è¡¨ã€‚

`_fesErrorMonitor`çš„è°ƒç”¨åºåˆ—å¤§è‡´å¦‚ä¸‹ï¼š

```
 _fesErrorMonitor
     processStack
       printFriendlyError
     (if type of error is ReferenceError)
       _handleMisspelling
         computeEditDistance
         _report
       _report
       printFriendlyStack
     (if type of error is SyntaxErrorã€TypeError, etc)
       _report
       printFriendlyStack
```


#### è¯­æ³•

```js
fesErrorMonitor(event);
```


#### å‚æ•°

```
@param {*}  e     é”™è¯¯äº‹ä»¶
```


#### ç¤ºä¾‹

å†…éƒ¨é”™è¯¯ç¤ºä¾‹1ï¼š

```js
function preload() {
  // ç”±äºåœ¨preloadä¸­è°ƒç”¨background()
  // å¯¼è‡´é”™è¯¯
  background(200);
}
```

FESå°†åœ¨æ§åˆ¶å°ä¸­ç”Ÿæˆä»¥ä¸‹æ¶ˆæ¯ï¼š

```
ğŸŒ¸ p5.js says: [sketch.js, line 8] å½“è°ƒç”¨"background"æ—¶ï¼Œp5jsåº“å†…éƒ¨å‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼Œé”™è¯¯ä¿¡æ¯ä¸º"æ— æ³•è¯»å–æœªå®šä¹‰çš„å±æ€§ï¼ˆæ­£åœ¨è¯»å–'background'ï¼‰"ã€‚å¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œè¿™å¯èƒ½æ˜¯ç”±äºä»preloadè°ƒç”¨"background"å¯¼è‡´çš„ã€‚preloadå‡½æ•°ä¸­é™¤äº†åŠ è½½è°ƒç”¨ï¼ˆloadImageã€loadJSONã€loadFontã€loadStringsç­‰ï¼‰ä¹‹å¤–ï¼Œä¸åº”è¯¥æœ‰ä»»ä½•å…¶ä»–å†…å®¹ã€‚ (https://p5js.org/reference/p5/preload)
```

å†…éƒ¨é”™è¯¯ç¤ºä¾‹2ï¼š

```js
function setup() {
  cnv = createCanvas(200, 200);
  cnv.mouseClicked();
}
```

FESå°†åœ¨æ§åˆ¶å°ä¸­ç”Ÿæˆä»¥ä¸‹æ¶ˆæ¯ï¼š

```js
ğŸŒ¸ p5.js says: [sketch.js, line 12] å½“è°ƒç”¨mouseClickedæ—¶ï¼Œp5jsåº“å†…éƒ¨å‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼Œé”™è¯¯ä¿¡æ¯ä¸º"æ— æ³•è¯»å–æœªå®šä¹‰çš„å±æ€§ï¼ˆæ­£åœ¨è¯»å–'bind'ï¼‰"ã€‚å¦‚æœæ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼Œè¿™å¯èƒ½æ˜¯ä¼ é€’ç»™mouseClickedçš„å‚æ•°é—®é¢˜ã€‚ (https://p5js.org/reference/p5/mouseClicked)
```

é”™è¯¯ç¤ºä¾‹ï¼ˆä½œç”¨åŸŸï¼‰ï¼š

```js
function setup() {
  let b = 1;
}
function draw() {
  b += 1;
}
```

FESå°†åœ¨æ§åˆ¶å°ä¸­ç”Ÿæˆä»¥ä¸‹æ¶ˆæ¯ï¼š

```
ğŸŒ¸ p5.js says:

[sketch.js, line 5] å½“å‰ä½œç”¨åŸŸä¸­æœªå®šä¹‰"b"ã€‚å¦‚æœæ‚¨å·²åœ¨ä»£ç ä¸­å®šä¹‰äº†å®ƒï¼Œåº”æ£€æŸ¥å…¶ä½œç”¨åŸŸã€æ‹¼å†™å’Œå¤§å°å†™ï¼ˆJavaScriptåŒºåˆ†å¤§å°å†™ï¼‰ã€‚

+ æ›´å¤šä¿¡æ¯ï¼šhttps://p5js.org/examples/data-variable-scope.html
```

é”™è¯¯ç¤ºä¾‹ï¼ˆæ‹¼å†™ï¼‰ï¼š

```js
function setup() {
  xolor(1, 2, 3);
}
```

FESå°†åœ¨æ§åˆ¶å°ä¸­ç”Ÿæˆä»¥ä¸‹æ¶ˆæ¯ï¼š

```
ğŸŒ¸ p5.js says: [sketch.js, line 2] æ‚¨å¯èƒ½ä¸å°å¿ƒå†™äº†"xolor"è€Œä¸æ˜¯"color"ã€‚å¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨p5.jsä¸­çš„å‡½æ•°ï¼Œè¯·å°†å…¶æ›´æ­£ä¸ºcolorã€‚ (https://p5js.org/reference/p5/color)
```


#### ä½ç½®

core/friendly\_errors/fes\_core.js


### `checkForUserDefinedFunctions()`

#### æè¿°

æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•ç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼ˆ`setup()`ã€`draw()`ã€`mouseMoved()`ç­‰ï¼‰å¸¦æœ‰å¤§å°å†™é”™è¯¯ã€‚

å®ƒè°ƒç”¨`translator()`ä½¿ç”¨é”®`fes.checkUserDefinedFns`ç”Ÿæˆå¹¶æ‰“å°å‹å¥½é”™è¯¯æ¶ˆæ¯ã€‚æ‚¨å¯ä»¥åœ¨`translations/en/translation.json`ä¸­æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„é”®ã€‚


#### è¯­æ³•

```js
checkForUserDefinedFunctions(context);
```


#### å‚æ•°

```
@param {*} context  å½“å‰é»˜è®¤ä¸Šä¸‹æ–‡ã€‚
                    åœ¨"å…¨å±€æ¨¡å¼"ä¸‹è®¾ç½®ä¸ºwindowï¼Œ
                    åœ¨"å®ä¾‹æ¨¡å¼"ä¸‹è®¾ç½®ä¸ºp5å®ä¾‹
```


#### ç¤ºä¾‹

```js
function preload() {
  loadImage('myimage.png');
}
```

FESå°†åœ¨æ§åˆ¶å°ä¸­ç”Ÿæˆä»¥ä¸‹æ¶ˆæ¯ï¼š

```
ğŸŒ¸ p5.js says: æ‚¨å¯èƒ½ä¸å°å¿ƒå†™äº†preLoadè€Œä¸æ˜¯preloadã€‚å¦‚æœè¿™ä¸æ˜¯æœ‰æ„çš„ï¼Œè¯·æ›´æ­£å®ƒã€‚ (https://p5js.org/reference/p5/preload)
```


#### ä½ç½®

/friendly\_errors/fes\_core.js


### `helpForMisusedAtTopLevelCode()`

#### æè¿°

`helpForMisusedAtTopLevelCode()`åœ¨çª—å£åŠ è½½æ—¶ç”±`fes_core.js`è°ƒç”¨ï¼Œä»¥æ£€æŸ¥åœ¨`setup()`æˆ–`draw()`ä¹‹å¤–ä½¿ç”¨p5.jså‡½æ•°çš„æƒ…å†µã€‚

å®ƒè°ƒç”¨`translator()`ä½¿ç”¨é”®`fes.misusedTopLevel`ç”Ÿæˆå¹¶æ‰“å°å‹å¥½é”™è¯¯æ¶ˆæ¯ã€‚æ‚¨å¯ä»¥åœ¨`translations/en/translation.json`ä¸­æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„é”®ã€‚


#### å‚æ•°

```
@param {*}        err    é”™è¯¯äº‹ä»¶
@param {Boolean}  log    false
```


#### ä½ç½®

/friendly\_errors/fes\_core.js


## ğŸ’Œ å¼€å‘ç¬”è®°

### å·²çŸ¥é™åˆ¶

#### å‡é˜³æ€§ä¸å‡é˜´æ€§æƒ…å†µ

åœ¨FESä¸­ï¼Œæ‚¨å¯èƒ½ä¼šé‡åˆ°ä¸¤ç§ç±»å‹çš„é”™è¯¯ï¼šå‡é˜³æ€§å’Œå‡é˜´æ€§ã€‚æŠŠå‡é˜³æ€§æƒ³è±¡æˆè™šå‡è­¦æŠ¥ã€‚å½“FESè­¦å‘Šæ‚¨æœ‰é”™è¯¯ï¼Œä½†æ‚¨çš„ä»£ç å®é™…ä¸Šæ˜¯æ­£ç¡®çš„æ—¶ï¼Œå°±ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚å¦ä¸€æ–¹é¢ï¼Œå‡é˜´æ€§å°±åƒé—æ¼äº†ä¸€ä¸ªé”™è¯¯ã€‚å½“æ‚¨çš„ä»£ç ä¸­æœ‰é”™è¯¯ï¼Œä½†FESæ²¡æœ‰æé†’æ‚¨æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚

è¯†åˆ«å’Œä¿®å¤è¿™äº›é”™è¯¯å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥èŠ‚çœè°ƒè¯•æ—¶é—´ï¼Œå‡å°‘æ··æ·†ï¼Œå¹¶ä½¿ä¿®å¤å®é™…é—®é¢˜å˜å¾—æ›´å®¹æ˜“ã€‚

åœ¨æŸäº›ä¸ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œé”™è¯¯å¤„ç†çš„è®¾è®¡å¯èƒ½éœ€è¦é€‰æ‹©æ¶ˆé™¤å‡é˜³æ€§æˆ–å‡é˜´æ€§ã€‚å¦‚æœå¿…é¡»é€‰æ‹©ï¼Œé€šå¸¸æœ€å¥½æ¶ˆé™¤å‡é˜³æ€§ã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥é¿å…ç”Ÿæˆå¯èƒ½åˆ†æ•£æ³¨æ„åŠ›æˆ–è¯¯å¯¼ç”¨æˆ·çš„ä¸æ­£ç¡®è­¦å‘Šã€‚


#### ä¸`fes.GlobalErrors`ç›¸å…³çš„é™åˆ¶

FESåªèƒ½æ£€æµ‹åˆ°ä½¿ç”¨`const`æˆ–`var`å£°æ˜çš„è¢«è¦†ç›–çš„å…¨å±€å˜é‡ã€‚ä½¿ç”¨letå£°æ˜çš„å˜é‡ä¸ä¼šè¢«æ£€æµ‹åˆ°ã€‚è¿™ä¸ªé™åˆ¶æ˜¯ç”±äº`let`å¤„ç†å˜é‡å®ä¾‹åŒ–çš„ç‰¹å®šæ–¹å¼å¯¼è‡´çš„ï¼Œç›®å‰æ— æ³•è§£å†³ã€‚

`fesErrorMonitor()`ä¸‹æè¿°çš„åŠŸèƒ½ç›®å‰ä»…åœ¨Webç¼–è¾‘å™¨ä¸Šæˆ–åœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Šè¿è¡Œæ—¶æœ‰æ•ˆã€‚æœ‰å…³æ›´å¤šè¯¦æƒ…ï¼Œè¯·å‚è§ pull request \[[#4730](https://github.com/processing/p5.js/pull/4730)]ã€‚


### FESçš„æ€§èƒ½é—®é¢˜

é»˜è®¤æƒ…å†µä¸‹ï¼Œp5.jså¯ç”¨FESï¼Œè€Œåœ¨`p5.min.js`ä¸­ç¦ç”¨ï¼Œä»¥é˜²æ­¢FESå‡½æ•°å‡æ…¢è¿›ç¨‹ã€‚é”™è¯¯æ£€æŸ¥ç³»ç»Ÿå¯èƒ½ä¼šæ˜¾è‘—å‡æ…¢æ‚¨çš„ä»£ç ï¼ˆåœ¨æŸäº›æƒ…å†µä¸‹æœ€å¤šæ…¢10å€ï¼‰ã€‚è¯·å‚è§[å‹å¥½é”™è¯¯æ€§èƒ½æµ‹è¯•](https://github.com/processing/p5.js-website/tree/main/src/assets/learn/performance/code/friendly-error-system)ã€‚

æ‚¨å¯ä»¥åœ¨è‰å›¾é¡¶éƒ¨ä½¿ç”¨ä¸€è¡Œä»£ç ç¦ç”¨FESï¼š

```js
p5.disableFriendlyErrors = true; // ç¦ç”¨FES
function setup() {
  // è¿›è¡Œè®¾ç½®æ“ä½œ
}
function draw() {
  // è¿›è¡Œç»˜åˆ¶æ“ä½œ
}
```

è¯·æ³¨æ„ï¼Œæ­¤æ“ä½œå°†ç¦ç”¨å·²çŸ¥ä¼šé™ä½æ€§èƒ½çš„FESæŸäº›åŠŸèƒ½ï¼Œä¾‹å¦‚å‚æ•°æ£€æŸ¥ã€‚ä½†æ˜¯ï¼Œä¸å½±å“æ€§èƒ½çš„å‹å¥½é”™è¯¯æ¶ˆæ¯ä»å°†å¯ç”¨ã€‚è¿™åŒ…æ‹¬åœ¨æ–‡ä»¶åŠ è½½å¤±è´¥æ—¶æä¾›è¯¦ç»†çš„é”™è¯¯æ¶ˆæ¯ï¼Œæˆ–è€…åœ¨æ‚¨å°è¯•è¦†ç›–å…¨å±€ç©ºé—´ä¸­çš„p5.jså‡½æ•°æ—¶æ˜¾ç¤ºè­¦å‘Šã€‚


### æœªæ¥å·¥ä½œçš„æƒ³æ³•

- è§£è€¦FES \[[#5629](https://github.com/processing/p5.js/issues/5629)]
- æ¶ˆé™¤å‡é˜³æ€§æƒ…å†µ
- è¯†åˆ«å‡é˜´æ€§æƒ…å†µ
- æ·»åŠ æ›´å¤šå•å…ƒæµ‹è¯•ä»¥è·å¾—å…¨é¢çš„æµ‹è¯•è¦†ç›–
- æ›´ç›´è§‚ã€æ¸…æ™°ä¸”å¯ç¿»è¯‘çš„æ¶ˆæ¯ã€‚å…³äºå‹å¥½é”™è¯¯å›½é™…åŒ–çš„æ›´å¤šè®¨è®ºï¼Œè¯·æŸ¥çœ‹[å‹å¥½é”™è¯¯i18næ‰‹å†Œ](https://almchung.github.io/p5-fes-i18n-book/en/)ã€‚
- è¯†åˆ«æ›´å¤šå¸¸è§é”™è¯¯ç±»å‹å¹¶ä½¿ç”¨FESè¿›è¡Œæ³›åŒ–ï¼ˆä¾‹å¦‚ `bezierVertex()`ã€`quadraticVertex()` - å¿…éœ€å¯¹è±¡æœªåˆå§‹åŒ–ï¼›æ£€æŸ¥ `nf()`ã€`nfc()`ã€`nfp()`ã€`nfs()` çš„Numberå‚æ•°æ˜¯å¦ä¸ºæ­£ï¼‰


## ç»“è®º

åœ¨æœ¬READMEæ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬æ¦‚è¿°äº†`core/friendly_errors`æ–‡ä»¶å¤¹çš„ç»“æ„ã€‚æœ¬èŠ‚è§£é‡Šäº†è¿™ä¸ªæ–‡ä»¶å¤¹çš„ç»„ç»‡å’Œç›®çš„ï¼Œä½¿å…¶æ›´å®¹æ˜“å¯¼èˆªå’Œç†è§£ã€‚æ­¤å¤–ï¼Œå¯¹äºæ­¤æ–‡ä»¶å¤¹ä¸­çš„æ¯ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬éƒ½æä¾›äº†å‚è€ƒæŒ‡å—ã€‚

åœ¨æœ¬æ–‡æ¡£çš„ååŠéƒ¨åˆ†ï¼Œæˆ‘ä»¬åŒ…å«äº†ä»¥å‰è´¡çŒ®è€…çš„ç¬”è®°ï¼Œè®¨è®ºäº†FESçš„å½“å‰é™åˆ¶å’Œæœªæ¥å¼€å‘ä¸­å¯èƒ½çš„æ”¹è¿›é¢†åŸŸã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬å¾ˆé«˜å…´é€šè¿‡2021-2022å¹´è¿›è¡Œçš„FESè°ƒæŸ¥åˆ†äº«æ¥è‡ªæˆ‘ä»¬ç¤¾åŒºçš„è§è§£ã€‚è°ƒæŸ¥ç»“æœæœ‰ä¸¤ç§æ ¼å¼å¯ä¾›æŸ¥é˜…ï¼š

- [21-22 FESè°ƒæŸ¥æŠ¥å‘Šæ¼«ç”»](https://almchung.github.io/p5jsFESsurvey/)
- [21-22 FESè°ƒæŸ¥å®Œæ•´æŠ¥å‘Š](https://observablehq.com/@almchung/p5-fes-21-survey)ã€‚

<!-- TODO: å½“æˆ‘ä»¬å‘å¸ƒä¸‹é¢çš„æ–‡ç« æ—¶å–æ¶ˆæ³¨é‡Š -->
<!-- å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾å‘æ–¹æ³•æ·»åŠ å‹å¥½é”™è¯¯æ¶ˆæ¯çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å»ºè®®æŸ¥çœ‹[å¦‚ä½•æ·»åŠ å‹å¥½é”™è¯¯æ¶ˆæ¯](#)ã€‚å®ƒå°†ä¸€æ­¥æ­¥å¼•å¯¼æ‚¨å®Œæˆå‘æ–¹æ³•æ·»åŠ è¿™äº›é”™è¯¯æ¶ˆæ¯çš„è¿‡ç¨‹ã€‚ --> 